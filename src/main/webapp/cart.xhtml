<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:body>
    <ui:composition template="./WEB-INF/templates/basicTemplate.xhtml">
        <ui:define name="content">

            <h:form id="cart-form">
                <div align="center" >
                    <h:panelGrid columns="2" cellpadding="5">
                        <h:outputLabel for="payJohnsonId" value="Pay Johnson ID"/>
                        <p:inputText id="payJohnsonId" value="#{cartModel.payJohnsonName}">
                            <p:ajax event="keyup"  update="buy-button"/>
                        </p:inputText>
                        <p:outputLabel value="Billing amount:   " />
                        <h:outputText value="#{cartModel.shopOrder.billingAmount * cartModel.discountFactor}">
                            <f:convertNumber minFractionDigits="2" type="currency" currencySymbol="â‚¬" locale="de-DE" />
                        </h:outputText>
                        <p:outputLabel for="discountCode" value="Discount Code:" />
                        <p:inputText id="discountCode" value="#{cartModel.discountCode}" placeholder="Discount code">
                            <p:ajax event="keyup"  update="discount-button"/>
                        </p:inputText>

                    </h:panelGrid>
                    <p:commandButton id="discount-button" action="#{cartModel.applyDiscountCode()}" value="Apply"
                                     style="width: 20%" disabled="#{cartModel.discountCode == null}"
                                     update="discount-dialog"
                                     oncomplete="$('#discount-dialog').show('fade');
                                     setTimeout(function() {
                                     $('#discount-dialog').hide('fade'); }, 3000);"
                    />
                    <p:commandButton id="buy-button" action="#{cartModel.buy()}" value="Buy" widgetVar="buyButton"
                                     style="background-color: green; width: 20%; color: white;"
                                     disabled="#{cartModel.shopOrder.articles.size()==0
                                                || cartModel.payJohnsonName == null}"
                                     onclick="PF('buyButton').disable()"
                                     oncomplete="PF('buyButton').enable()"
                                     update="cart-form"/>
                </div>
                <p:repeat value="#{cartModel.shopOrder.articles}" var="article">
                    <h:panelGrid columns="3" style="width:100%">
                        <p:graphicImage style="width: 20%;" value="#{article.picturePath}"/>

                        <p:outputPanel>
                            <h:panelGrid columns="2" cellpadding="5">
                                <h:outputText value="Article: " />
                                <h:outputText value="#{article.artName}" style="font-weight: bold"/>

                                <h:outputText value="Price:" />
                                <h:outputText value="#{article.price}" style="font-weight: bold"/>
                            </h:panelGrid>
                        </p:outputPanel>

                        <p:commandButton value="Remove" style="background-color: darkred; color: white"
                                         action="#{cartModel.removeArticleFromCart(article)}"
                                         update="top-form cart-form"/>
                    </h:panelGrid>
                    <hr />
                </p:repeat>

            </h:form>
            <p:dialog id="pay-dialog-success" widgetVar="pay_dialog_success" modal="true" resizable="false"
                      header="Pay Johnson confirmed" showEffect="fade" hideEffect="fade">
                <div align="center" style="width: 100%">
                    <h4>Pay Johnson confirmed your data, we are waiting for the confirmation <br/>of the transaction and
                    will send your stuff afterwards</h4>
                </div>
            </p:dialog>
            <p:dialog id="pay-dialog-failure" widgetVar="pay_dialog_failure" modal="true" resizable="false"
                      header="Pay Johnson confirmation failed" showEffect="fade" hideEffect="fade">
                <div align="center">
                    <h4>Pay Johnson could not confirm your data please try again</h4>
                </div>
            </p:dialog>

            <p:dialog id="discount-dialog" draggable="false" closable="true" resizable="false" effect="slide"
                      widgetVar="discount_dialog">
                <div align="center">
                    <div align="center">
                        <p:commandButton value="Hide" style="width: 20%; background-color: red" action="#{cartModel.hideDiscountDialog()}" />
                    </div>
                    <h:graphicImage style="width: 40%" value="#{cartModel.discountMeme}" />
                </div>
            </p:dialog>
        </ui:define>

    </ui:composition>






</h:body>

</html>
